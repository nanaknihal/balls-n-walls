<!DOCTYPE html>
</html>
<head>
  <title>B a l l s  n'  W a l l s </title>
  <script src="jspsych-6.0.3/jspsych.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.0.3/plugins/mot-game.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-image-keyboard-response.js"></script>

  <link href="jspsych-6.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>

<body>

</body>
<script>
var timeline = []

var welcome = {
  type:"html-keyboard-response",
  stimulus:"Welcome to the game. Press any key to begin"
};
timeline.push(welcome);

var instructionsPt1 = {
  type:"html-keyboard-response",
  stimulus:"Many balls are innocuous but some are exploding. The exploding balls are briefly shown at the beginning of the level. Then they are no longer highlighted. <br />"+
           "Prevent the exploding balls from hitting the walls by drawing your own walls! Do so by clicking and dragging. Your wall can have multiple edges but the vertices between them cannot be too close! <br />"+
           "That would make it too easy. <br /> Press any key to continue"
};
timeline.push(instructionsPt1);

var instructionsPt2 = {
  type:"html-keyboard-response",
  stimulus:"Exploding balls will be briefly shown in orange and then you'll have to remember which ones they are to prevent them from colliding. Don't worry; if you let one collide you'll have a chance to defuse the <br /> exploding balls and save the day!"
};
timeline.push(instructionsPt2);

/*width and height: */
/*var w=650, h=650;
var game = {
  type:"html-keyboard-response",
  stimulus: "<!--main canvas where game happens:-->" +
  "<canvas id='mainCanvas' height='" + h + "' width = '" + w + "'></canvas>" + "<button onclick='curLevel.beginGame()'>S T A R T</button>"
  +
  "<!--overlay canvas that doesn't need to be refreshed constantly:-->" +
  //it may be good to not hard-code the top and left value but rather use variables...this will be decided later when we do more styling
  "<canvas id='overlay' style='position:absolute; left: 0; top: 0; z-index:2' height='" + h + "' width = '" + w + "'></canvas>"
  +
  "<!--selection canvas for ball selection in defusal mode:-->" +
  //it may be good to not hard-code the top and left value but rather use variables...this will be decided later when we do more styling
  "<canvas id='selectionCanvas' style='position:absolute; left: 0; top: 0; z-index:1' height='" + h + "' width = '" + w + "'></canvas>"

};*/
var level1 = {
  type:"mot-game",
  stimulus:"<p>test</p>",
  duration: 15000,
  ballSpeed: 0.04,
  ballRadius: 20,
  numRegularBalls: 7,
  numExplodingBalls: 2,
  maxUserDefinedObstacles: 1,
  maxUserDefinedObstacleSegments: 3,
  maxDistanceBetweenObstaclePixels:300,
  minDistanceBetweenObstaclePixels: 66,
  occluders: true,
  occluderRectangles:[{x: 100, y: 0, width: 45, height: 650},{x: 300, y: 0, width: 45, height: 650}],
  replayMode: true,
  replayModeParameters: {"ballInitialConditions":[
			{
				"explosive": false,
				"position": [
					580,
					338
				],
				"velocity": [
					-0.01487872629803478,
					-0.03712981960295752
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					369,
					386
				],
				"velocity": [
					0.007699472378464788,
					0.03925198243520011
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					219,
					337
				],
				"velocity": [
					-0.038464248621178684,
					-0.01097732107611662
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					216,
					296
				],
				"velocity": [
					-0.003054943098724051,
					0.03988317092037139
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					247,
					269
				],
				"velocity": [
					-0.037261108477863965,
					0.014546813912360812
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					180,
					222
				],
				"velocity": [
					0.014544973042381002,
					-0.03726182710491274
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					392,
					425
				],
				"velocity": [
					-0.015459855298663307,
					0.03689163691332213
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					446,
					357
				],
				"velocity": [
					-0.03236851516372982,
					-0.02350062182358996
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					436,
					328
				],
				"velocity": [
					-0.02988914522651023,
					0.026582682288072076
				],
				"radius": 20
			}
		],
		"ballSpeed": 0.04,
		"maxObstacles": 1,
		"maxObstacleSegments": 3,
		"createdPoints": [
			{
				"position": [
					516,
					429
				],
				"timeCreated": 1941.70000000031,
				"eventType": "mousedown"
			},
			{
				"position": [
					563,
					181
				],
				"timeCreated": 3662.800000000061,
				"eventType": "mousedown"
			},
			{
				"position": [
					572,
					258
				],
				"timeCreated": 3821.3999999998123,
				"eventType": "mousemove"
			},
			{
				"position": [
					579,
					331
				],
				"timeCreated": 3893.000000000029,
				"eventType": "mousemove"
			},
			{
				"position": [
					584,
					399
				],
				"timeCreated": 3988.6999999998807,
				"eventType": "mousemove"
			},
			{
				"position": [
					598,
					469
				],
				"timeCreated": 4140.000000000327,
				"eventType": "mousemove"
			},
			{
				"position": [
					602,
					127
				],
				"timeCreated": 5452.199999999721,
				"eventType": "mousedown"
			},
			{
				"position": [
					605,
					202
				],
				"timeCreated": 5690.000000000509,
				"eventType": "mousemove"
			},
			{
				"position": [
					617,
					268
				],
				"timeCreated": 5873.199999999997,
				"eventType": "mousemove"
			},
			{
				"position": [
					557,
					566
				],
				"timeCreated": 6910.100000000057,
				"eventType": "mousedown"
			},
			{
				"position": [
					452,
					565
				],
				"timeCreated": 7156.200000000354,
				"eventType": "mousemove"
			},
			{
				"position": [
					456,
					39
				],
				"timeCreated": 9882.700000000114,
				"eventType": "mousedown"
			},
			{
				"position": [
					384,
					66
				],
				"timeCreated": 10104.800000000068,
				"eventType": "mousemove"
			},
			{
				"position": [
					203,
					317
				],
				"timeCreated": 13162.500000000364,
				"eventType": "mousedown"
			},
			{
				"position": [
					254,
					268
				],
				"timeCreated": 13431.59999999989,
				"eventType": "mousemove"
			}
		]
  },
  gameWidth: 650,
  gameHeight: 650
}
timeline.push(level1);

var waitingScreen = {type:"html-keyboard-response", stimulus: "hit any key when you're ready for level 2"}
timeline.push(waitingScreen)

var level2 = {
  type:"mot-game",
  stimulus:"<p>test</p>",
  duration: 15000,
  ballSpeed: 0.04,
  ballRadius: 20,
  numRegularBalls: 7,
  numExplodingBalls: 2,
  maxUserDefinedObstacles: 1,
  maxUserDefinedObstacleSegments: 3,
  maxDistanceBetweenObstaclePixels:300,
  minDistanceBetweenObstaclePixels: 66,
  occluders: true,
  occluderRectangles:[{x: 100, y: 0, width: 45, height: 650},{x: 300, y: 0, width: 45, height: 650}],
  replayMode: false,
  replayModeParameters: {"ballInitialConditions": [
			{
				"explosive": false,
				"position": [
					169,
					417
				],
				"velocity": [
					-0.037950214602128544,
					0.012640459313347327
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					582,
					237
				],
				"velocity": [
					-0.02799547531575249,
					-0.028570148089309813
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					249,
					613
				],
				"velocity": [
					-0.007133331125697176,
					-0.03935880571169761
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					430,
					499
				],
				"velocity": [
					-0.025442199677921457,
					-0.030865749230316337
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					559,
					221
				],
				"velocity": [
					-0.039995415685717205,
					-0.0006055775150102931
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					272,
					163
				],
				"velocity": [
					-0.012777366800327905,
					-0.03790433877077766
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					238,
					527
				],
				"velocity": [
					-0.016473346092191442,
					0.036450361706393
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					408,
					363
				],
				"velocity": [
					-0.022181154523178474,
					-0.03328657963832991
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					274,
					248
				],
				"velocity": [
					-0.02323039827758855,
					0.03256299427056134
				],
				"radius": 20
			}
		],
		"ballSpeed": 0.04,
		"maxObstacles": 1,
		"maxObstacleSegments": 3,
		"createdPoints": [
			{
				"position": [
					281,
					91
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					161,
					93
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					126,
					149
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					174,
					205
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					229,
					242
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					259,
					49
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					105,
					3
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					444,
					45
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					522,
					68
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					582,
					122
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					581,
					190
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					525,
					229
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					387,
					251
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					381,
					318
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					440,
					361
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					515,
					357
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					574,
					317
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					582,
					245
				],
				"timeCreated": null,
				"eventType": "mousemove"
			}
		]
  },
  gameWidth: 650,
  gameHeight: 650
}
timeline.push(level2);

/* CODE FROM THE JSPSYCH TUTORIAL:
var blue_trial = {
  type:"image-keyboard-response",
  stimulus: "img/blue.png",
  choices: ["f","j"]
}

var orange_trial = {
  type: "image-keyboard-response",
  stimulus: "img/orange.png",
  choices: ["f", "j"]
}

var test_stimuli = [
  {stimulus: "img/blue.png", data: {test_part: "test", correct_response: "f"}},
  {stimulus: "img/orange.png", data: {test_part: "test", correct_response:"j"}}]
timeline.push(blue_trial,orange_trial);

var fixation = {
  type: "html-keyboard-response",
  stimulus: "<div style='font-size:60px;'>+</div>",
  choices: jsPsych.NO_KEYS,
  trial_duration: jsPsych.randomization.sampleWithoutReplacement(
    [250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0],
  data: {test_part: "fixation"}
}

var test = {
  type:"image-keyboard-response",
  stimulus:jsPsych.timelineVariable("stimulus"),
  choices:["f","j"],
  data:jsPsych.timelineVariable("data"),
  on_finish: function(data){
    data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
  }
}

var test_procedure = {
  timeline:[fixation, test],
  timeline_variables: test_stimuli,
  randomize_order: true,
  repetitions: 5
}
timeline.push(test_procedure);
*/
jsPsych.init({
  timeline: timeline,
  on_finish: function(){
    jsPsych.data.displayData();
  }
})

</script>
</html>
