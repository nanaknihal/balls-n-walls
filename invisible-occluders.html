<!DOCTYPE html>
</html>
<head>
  <title>B a l l s  n'  W a l l s </title>
  <script src="jspsych-6.0.3/jspsych.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="mot-game.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-image-keyboard-response.js"></script>

  <link href="jspsych-6.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>

<body>

</body>
<script>
var gameWidth = 960, gameHeight = 600
var timeline = []

var welcome = {
  type:"html-keyboard-response",
  stimulus:"Welcome to the game. Press any key to begin"
};
timeline.push(welcome);

var instructionsPt1 = {
  type:"html-keyboard-response",
  stimulus:"<img src='robomb-pngs/screen-splash.svg' height='" + gameHeight + "'></img>'"
};
timeline.push(instructionsPt1);


/*width and height: */
/*var w=650, h=650;
var game = {
  type:"html-keyboard-response",
  stimulus: "<!--main canvas where game happens:-->" +
  "<canvas id='mainCanvas' height='" + h + "' width = '" + w + "'></canvas>" + "<button onclick='curLevel.beginGame()'>S T A R T</button>"
  +
  "<!--overlay canvas that doesn't need to be refreshed constantly:-->" +
  //it may be good to not hard-code the top and left value but rather use variables...this will be decided later when we do more styling
  "<canvas id='overlay' style='position:absolute; left: 0; top: 0; z-index:2' height='" + h + "' width = '" + w + "'></canvas>"
  +
  "<!--selection canvas for ball selection in defusal mode:-->" +
  //it may be good to not hard-code the top and left value but rather use variables...this will be decided later when we do more styling
  "<canvas id='selectionCanvas' style='position:absolute; left: 0; top: 0; z-index:1' height='" + h + "' width = '" + w + "'></canvas>"

};*/

function generateRandomOccluderXCoordinate(occluderToWallMinDistance){
  return occluderToWallMinDistance+Math.random()*(gameWidth-2*occluderToWallMinDistance)
}

console.log(generateRandomOccluderXCoordinate(10))
var level1 = {
  type:"mot-game",
  stimulus:"<p>test</p>",
  duration: 15000,
  ballSpeed: 0.07,
  ballRadius: 20,
  numRegularBalls: 4,
  numExplodingBalls: 4,
  maxUserDefinedObstacles: 1,
  maxUserDefinedObstacleSegments: 3,
  maxDistanceBetweenObstaclePixels:300,
  minDistanceBetweenObstaclePixels: 66,
  userObstacleThickness: 3,
  wallThickness:16,  //16px thick border walls
  occludersEnabled: true,
  invisibleOccluders: true,
  implodeExplodeMode: false,
  stochasticRobotPaths: true,
  parametersForStochasticRobotPaths: {inertia: 0.95, springConstant: 0, accelerationStandardDeviation: 0.01, velocityMultipler: 1.030},
  forceFields: false,
  forceFieldStrength: 0.0006,
  occluderRectangles:[{x: generateRandomOccluderXCoordinate(/*put minimum occluder distance from wall here*/100), y: 0, width: 45, height: gameHeight},{x: generateRandomOccluderXCoordinate(190), y: 0, width: 45, height: gameHeight}],
  lives: true, //toggle whether the player has a fixed number of lives and the related gameplay aspects
  numLives: 5,
  //replayMode: false,
  replayModeParameters: /*{"ballInitialConditions":[
			{
				"explosive": false,
				"position": [
					452,
					361
				],
				"velocity": [
					0.03860096841357722,
					-0.01048643111520854
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					614,
					456
				],
				"velocity": [
					0.013557549308971684,
					0.037632337912157435
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					438,
					348
				],
				"velocity": [
					0.0351144783069237,
					0.019156550139119124
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					388,
					405
				],
				"velocity": [
					0.03380436441892031,
					0.021383754259550275
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					272,
					618
				],
				"velocity": [
					-0.03999344038568691,
					-0.0007243798150881363
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					537,
					595
				],
				"velocity": [
					0.03944547382565874,
					-0.0066373635330055246
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					568,
					455
				],
				"velocity": [
					0.02702510830056431,
					0.029489718909185454
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					265,
					315
				],
				"velocity": [
					-0.03893091564541011,
					0.009186065915829383
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					254,
					269
				],
				"velocity": [
					-0.026472597947135083,
					-0.029986689679411756
				],
				"radius": 20
			}
		],
		"ballSpeed": 0.04,
		"maxObstacles": 1,
		"maxObstacleSegments": 3,
		"createdPoints": [
			{
				"position": [
					256,
					358
				],
				"timeCreated": 770.299999974668,
				"eventType": "mousedown"
			},
			{
				"position": [
					330,
					353
				],
				"timeCreated": 952.4000000092201,
				"eventType": "mousemove"
			},
			{
				"position": [
					390,
					300
				],
				"timeCreated": 1223.4000000171363,
				"eventType": "mousemove"
			},
			{
				"position": [
					365,
					160
				],
				"timeCreated": 4248.599999991711,
				"eventType": "mousedown"
			},
			{
				"position": [
					438,
					174
				],
				"timeCreated": 4422.69999999553,
				"eventType": "mousemove"
			},
			{
				"position": [
					397,
					326
				],
				"timeCreated": 7535.399999993388,
				"eventType": "mousedown"
			},
			{
				"position": [
					398,
					457
				],
				"timeCreated": 8227.399999974295,
				"eventType": "mousemove"
			},
			{
				"position": [
					542,
					290
				],
				"timeCreated": 10212.400000018533,
				"eventType": "mousedown"
			},
			{
				"position": [
					391,
					473
				],
				"timeCreated": 11276.000000012573,
				"eventType": "mousedown"
			},
			{
				"position": [
					456,
					446
				],
				"timeCreated": 11442.800000018906,
				"eventType": "mousemove"
			},
			{
				"position": [
					520,
					415
				],
				"timeCreated": 11546.199999982491,
				"eventType": "mousemove"
			},
			{
				"position": [
					533,
					111
				],
				"timeCreated": 13244.400000025053,
				"eventType": "mousedown"
			},
			{
				"position": [
					605,
					148
				],
				"timeCreated": 13466.2000000244,
				"eventType": "mousemove"
			},
			{
				"position": [
					632,
					209
				],
				"timeCreated": 13665.500000002794,
				"eventType": "mousemove"
			},
			{
				"position": [
					413,
					293
				],
				"timeCreated": 16554.699999978766,
				"eventType": "mousedown"
			},
			{
				"position": [
					458,
					376
				],
				"timeCreated": 7989.6999999764375,
				"eventType": "mousedown"
			},
			{
				"position": [
					459,
					392
				],
				"timeCreated": 8523.600000014994,
				"eventType": "mousedown"
			},
			{
				"position": [
					626,
					105
				],
				"timeCreated": 9725.700000009965,
				"eventType": "mousedown"
			}
		]
  }*/null,
  savedModel: [],
  gameWidth: 960,
  gameHeight: 600
}
timeline.push(level1);

var waitingScreen = {type:"html-keyboard-response", stimulus: "hit any key when you're ready for level 2"}
timeline.push(waitingScreen)

var level2 = {
  type:"mot-game",
  stimulus:"<p>test</p>",
  duration: 15000,
  ballSpeed: 0.04,
  ballRadius: 20,
  numRegularBalls: 7,
  numExplodingBalls: 2,
  maxUserDefinedObstacles: 1,
  maxUserDefinedObstacleSegments: 3,
  maxDistanceBetweenObstaclePixels:300,
  minDistanceBetweenObstaclePixels: 66,
  occluders: true,
  occluderRectangles:[{x: 100, y: 0, width: 45, height: 650},{x: 300, y: 0, width: 45, height: 650}],
  //replayMode: true,
  replayModeParameters: {"ballInitialConditions": [
			{
				"explosive": false,
				"position": [
					50,
					509
				],
				"velocity": [
					0.017916956375434237,
					-0.0357628672541896
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					443,
					399
				],
				"velocity": [
					-0.030441122573847866,
					-0.025948758283277643
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					246,
					545
				],
				"velocity": [
					-0.02676114842342577,
					0.029729462407843448
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					404,
					207
				],
				"velocity": [
					-0.034743494190858766,
					-0.019821443222171373
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					533,
					615
				],
				"velocity": [
					0.03454888136338343,
					-0.020158739954145372
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					247,
					183
				],
				"velocity": [
					-0.038393783381382905,
					0.011221292156585438
				],
				"radius": 20
			},
			{
				"explosive": false,
				"position": [
					479,
					357
				],
				"velocity": [
					-0.03892035296228009,
					0.009230716401858281
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					239,
					206
				],
				"velocity": [
					0.025074907564821163,
					0.031164868211107113
				],
				"radius": 20
			},
			{
				"explosive": true,
				"position": [
					234,
					237
				],
				"velocity": [
					0.005735890223595737,
					0.039586608383932805
				],
				"radius": 20
			}
		],
		"ballSpeed": 0.04,
		"maxObstacles": 1,
		"maxObstacleSegments": 3,
		"createdPoints": [
			{
				"position": [
					281,
					91
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					161,
					93
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					126,
					149
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					174,
					205
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					229,
					242
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					259,
					49
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					105,
					3
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					444,
					45
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					522,
					68
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					582,
					122
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					581,
					190
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					525,
					229
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					387,
					251
				],
				"timeCreated": null,
				"eventType": "mousedown"
			},
			{
				"position": [
					381,
					318
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					440,
					361
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					515,
					357
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					574,
					317
				],
				"timeCreated": null,
				"eventType": "mousemove"
			},
			{
				"position": [
					582,
					245
				],
				"timeCreated": null,
				"eventType": "mousemove"
			}
		]
  },
  gameWidth: 650,
  gameHeight: 650
}
//timeline.push(level2);

/* CODE FROM THE JSPSYCH TUTORIAL:
var blue_trial = {
  type:"image-keyboard-response",
  stimulus: "img/blue.png",
  choices: ["f","j"]
}

var orange_trial = {
  type: "image-keyboard-response",
  stimulus: "img/orange.png",
  choices: ["f", "j"]
}

var test_stimuli = [
  {stimulus: "img/blue.png", data: {test_part: "test", correct_response: "f"}},
  {stimulus: "img/orange.png", data: {test_part: "test", correct_response:"j"}}]
timeline.push(blue_trial,orange_trial);

var fixation = {
  type: "html-keyboard-response",
  stimulus: "<div style='font-size:60px;'>+</div>",
  choices: jsPsych.NO_KEYS,
  trial_duration: jsPsych.randomization.sampleWithoutReplacement(
    [250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0],
  data: {test_part: "fixation"}
}

var test = {
  type:"image-keyboard-response",
  stimulus:jsPsych.timelineVariable("stimulus"),
  choices:["f","j"],
  data:jsPsych.timelineVariable("data"),
  on_finish: function(data){
    data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
  }
}

var test_procedure = {
  timeline:[fixation, test],
  timeline_variables: test_stimuli,
  randomize_order: true,
  repetitions: 5
}
timeline.push(test_procedure);
*/
jsPsych.init({
  timeline: timeline,
  on_finish: function(){
    jsPsych.data.displayData();
  }
})

</script>
</html>
